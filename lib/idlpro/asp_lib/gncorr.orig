pro gncorr,imag,gntbl,out


;  procedure to apply pixel-by-pixel gain correction to a Stokes I image
;  using the gain tables generated by 

;  inputs:       imag = Stokes I image 
;		gntbl = pre-processed gain table from buildgn.pro

;  output:       out  = gain corrected Stokes I image

;  get dimensions of input array
  sz = size(imag)
  nx = sz(1)
  ny = sz(2)
  nx1 = nx-1
  ny1 = ny-1
  out = fltarr(nx,ny)

;  get dimensions of gain table
  szg = size(gntbl)
  ng1 = sz(1)
  ng2 = sz(2)
  ng3 = sz(3)
  ng4 = sz(4)
  print,'gain table array dimensions',ng1,ng2,ng3,ng4
  xv = fltarr(ng1)
  yv = xv
  nv = ng1-1

;  define active area of array, avoid vignetting at bottom
  iyst = 15
  ixst = 15


;  begin loop over pixels in image
  for j = 0,ny1 do for i = ixst,nx1 do begin

;  independent variable values for this pixel
   xv = gntbl(*,0,i,j)

;  dependent variable values for this pixel
   yv = gntbl(*,1,i,j)

;  obtain linearly interpolated intensity
   out(i,j) = interpol(yv,xv,imag(i,j))

;end loop over pixels
  endfor

;read,'  enter character to stop',bogus

end
